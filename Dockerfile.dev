ARG NODE_IMAGE=node:20-slim

FROM ${NODE_IMAGE} AS base

# System deps for dev tooling and native module builds (node-gyp)
RUN apt-get update \
  && apt-get install -y --no-install-recommends \
    procps \
    python3 \
    make \
    g++ \
  && rm -rf /var/lib/apt/lists/*

RUN npm install -g pnpm@9.12.2

FROM base AS development
WORKDIR /app

COPY package*.json pnpm-lock.yaml ./

RUN pnpm install
